本节目标：**建立“构建系统”的正确认知**，理解 CMake 在 C++ 工程中的角色，而不是只会照抄模板。

---

## 一、为什么一定要学 CMake？

* 编译 ≠ 构建
* 大型 C++ 项目不可能手写 g++ 命令
* CMake 是事实上的 **跨平台标准构建工具**

> **不会 CMake，本质上只能写“练习代码”，而不是工程代码。**

---

## 二、CMake 是什么？

* **构建系统生成器**
* 根据 `CMakeLists.txt`：

  * 生成 Makefile / Ninja / VS 工程

👉 CMake 本身不负责编译，只负责“如何编译”。

---

## 三、最小 CMake 项目结构

```text
project/
├── CMakeLists.txt
└── main.cpp
```

---

## 四、最基础的 CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.10)
project(hello_cmake)

add_executable(hello main.cpp)
```

说明：

* `cmake_minimum_required`：最低版本
* `project`：项目名
* `add_executable`：生成可执行文件

---

## 五、构建流程（必须理解）

```bash
mkdir build
cd build
cmake ..
cmake --build .
```

原则：

> **源码目录 ≠ 构建目录（out-of-source build）**

---

## 六、常见核心指令

### 1. add_library

```cmake
add_library(mylib mylib.cpp)
```

---

### 2. target_link_libraries

```cmake
target_link_libraries(app mylib)
```

---

### 3. target_include_directories

```cmake
target_include_directories(app PRIVATE include)
```

作用：

* 管理头文件搜索路径

---

## 七、现代 CMake 的核心思想（重点）

### 1. target 为中心

* 不再使用全局变量
* 一切围绕 target

### 2. PRIVATE / PUBLIC / INTERFACE

* PRIVATE：仅当前 target 使用
* PUBLIC：自己 + 依赖者
* INTERFACE：仅依赖者

---

## 八、常见新手误区

* 在 CMake 中写编译命令
* 使用全局 include_directories
* 不区分构建目录和源码目录

---

## 九、工程级总结

* CMake 描述“构建关系”，不是“编译细节”
* 现代 CMake = target 驱动

---

## 十、面试级总结

> CMake 的核心不是语法，而是工程结构建模能力，是否理解 target 与依赖关系，决定你能否维护中大型 C++ 项目。
