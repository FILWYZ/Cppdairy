### ä¸€ã€ä»€ä¹ˆæ˜¯ RAIIï¼Ÿï¼ˆä¸€å¥è¯ç‰ˆæœ¬ï¼‰

> **èµ„æºçš„è·å– = å¯¹è±¡çš„åˆå§‹åŒ–**
> **èµ„æºçš„é‡Šæ”¾ = å¯¹è±¡çš„ææ„**

RAII æ˜¯ C++ æœ€æ ¸å¿ƒã€æœ€â€œåç›´è§‰ä½†æœ€å¼ºå¤§â€çš„è®¾è®¡æ€æƒ³ä¹‹ä¸€ã€‚

---

### äºŒã€ä¸ºä»€ä¹ˆ RAII å¦‚æ­¤é‡è¦ï¼Ÿ

å…ˆçœ‹ä¸€ä¸ª **ä¸ç”¨ RAII çš„åä¾‹å­**ï¼š

```cpp
void func() {
    int* p = new int(10);
    if (some_error)
        return;     // âŒ å†…å­˜æ³„æ¼
    delete p;
}
```

é—®é¢˜æ ¹æºï¼š

* ç¨‹åºå‘˜ **æ‰‹åŠ¨ç®¡ç†èµ„æº**
* é‡åˆ° `return / å¼‚å¸¸ / åˆ†æ”¯` ææ˜“å¿˜è®°é‡Šæ”¾

ğŸ‘‰ RAII çš„ç›®æ ‡ï¼š

> **è®©â€œé‡Šæ”¾èµ„æºâ€å˜æˆç¼–è¯‘å™¨è‡ªåŠ¨å¸®ä½ åšçš„äº‹**

---

### ä¸‰ã€èµ„æº â‰  åªæœ‰å†…å­˜

åœ¨ C++ ä¸­ï¼Œä»¥ä¸‹éƒ½æ˜¯â€œèµ„æºâ€ï¼š

* å†…å­˜ï¼ˆ`new / malloc`ï¼‰
* æ–‡ä»¶ï¼ˆ`FILE* / fstream`ï¼‰
* é”ï¼ˆ`mutex`ï¼‰
* socket / çº¿ç¨‹ / æ•°æ®åº“è¿æ¥

ğŸ‘‰ **å‡¡æ˜¯â€œéœ€è¦æˆå¯¹é‡Šæ”¾â€çš„ä¸œè¥¿ï¼Œéƒ½æ˜¯èµ„æº**ã€‚

---

### å››ã€èµ„æºå³å¯¹è±¡ï¼ˆæ ¸å¿ƒæ€æƒ³ï¼‰

RAII çš„è®¾è®¡åŸåˆ™ï¼š

> **ç”¨ä¸€ä¸ªå¯¹è±¡æ¥â€œæ‹¥æœ‰â€èµ„æº**

* æ„é€ å‡½æ•°ï¼šè·å–èµ„æº
* ææ„å‡½æ•°ï¼šé‡Šæ”¾èµ„æº

å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ = èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ

---

### äº”ã€RAII ç®¡ç†å†…å­˜ï¼ˆæœ€ç»å…¸ï¼‰

```cpp
class IntWrapper {
public:
    int* p;

    IntWrapper(int x) {
        p = new int(x);   // æ„é€  â†’ è·å–èµ„æº
    }

    ~IntWrapper() {
        delete p;         // ææ„ â†’ é‡Šæ”¾èµ„æº
    }
};
```

ä½¿ç”¨è€…ï¼š

```cpp
void func() {
    IntWrapper w(10);
    if (error)
        return;   // âœ… ææ„è‡ªåŠ¨è°ƒç”¨ï¼Œæ— æ³„æ¼
}
```

---

### å…­ã€RAII ç®¡ç†æ–‡ä»¶

```cpp
#include <fstream>

void func() {
    std::ofstream ofs("test.txt");
    ofs << "Hello";
} // ç¦»å¼€ä½œç”¨åŸŸ â†’ æ–‡ä»¶è‡ªåŠ¨å…³é—­
```

ğŸ‘‰ `ofstream` å°±æ˜¯ä¸€ä¸ª **RAII ç±»**ã€‚

---

### ä¸ƒã€RAII ç®¡ç†é”ï¼ˆéå¸¸é‡è¦ï¼‰

âŒ é”™è¯¯å†™æ³•ï¼ˆæ˜“æ­»é”ï¼‰ï¼š

```cpp
mutex m;

void func() {
    m.lock();
    if (error)
        return;   // âŒ é”æ²¡é‡Šæ”¾
    m.unlock();
}
```

âœ… RAII æ­£ç¡®å†™æ³•ï¼š

```cpp
#include <mutex>

mutex m;

void func() {
    std::lock_guard<std::mutex> lock(m);
    // è‡ªåŠ¨åŠ é”
} // è‡ªåŠ¨è§£é”
```

---

### å…«ã€RAII + å¼‚å¸¸å®‰å…¨

RAII æ˜¯ C++ **å¼‚å¸¸å®‰å…¨çš„åŸºçŸ³**ã€‚

```cpp
void func() {
    IntWrapper w(10);
    throw std::runtime_error("error");
} // æ ˆå±•å¼€ â†’ ææ„å‡½æ•°å…¨éƒ¨è°ƒç”¨
```

ğŸ‘‰ **ä¸å†™ try / catch ä¹Ÿä¸æ³„æ¼èµ„æº**ã€‚

---

### ä¹ã€RAII ä¸æ™ºèƒ½æŒ‡é’ˆçš„å…³ç³»

* `unique_ptr`ï¼šRAII + ç‹¬å æ‰€æœ‰æƒ
* `shared_ptr`ï¼šRAII + å¼•ç”¨è®¡æ•°

ğŸ‘‰ **æ™ºèƒ½æŒ‡é’ˆ = RAII æ€æƒ³çš„æ ‡å‡†åº“å®ç°**ã€‚

---
