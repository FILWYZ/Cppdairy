### ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦æ™ºèƒ½æŒ‡é’ˆï¼Ÿ

åœ¨ Day11 ä½ å·²ç»ç†è§£ï¼š

* **RAII æ˜¯ C++ çš„çµé­‚**
* èµ„æºåº”è¯¥äº¤ç»™å¯¹è±¡è‡ªåŠ¨ç®¡ç†

é—®é¢˜æ¥äº†ï¼š

```cpp
int* p = new int(10);
// è°æ¥ deleteï¼Ÿä»€ä¹ˆæ—¶å€™ deleteï¼Ÿ
```

ğŸ‘‰ **æ™ºèƒ½æŒ‡é’ˆ = RAII æ€æƒ³åœ¨â€œæŒ‡é’ˆç®¡ç†â€ä¸Šçš„æ ‡å‡†å®ç°**ã€‚

---

### äºŒã€æ™ºèƒ½æŒ‡é’ˆè§£å†³çš„æ ¸å¿ƒé—®é¢˜

1. é˜²æ­¢å†…å­˜æ³„æ¼
2. æ˜ç¡®â€œèµ„æºæ‰€æœ‰æƒâ€
3. å¼‚å¸¸å®‰å…¨
4. è®©ä»£ç æ›´åƒâ€œå€¼è¯­ä¹‰â€

---

## ä¸‰ã€`unique_ptr` â€”â€” ç‹¬å æ‰€æœ‰æƒ

### 1ï¸âƒ£ æ ¸å¿ƒæ€æƒ³

> **ä¸€ä¸ªèµ„æºï¼Œåœ¨ä»»ä½•æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ª `unique_ptr` æ‹¥æœ‰**

* ä¸å…è®¸æ‹·è´
* å…è®¸ç§»åŠ¨

---

### 2ï¸âƒ£ åŸºæœ¬ç”¨æ³•

```cpp
#include <memory>

std::unique_ptr<int> p = std::make_unique<int>(10);
```

ç¦»å¼€ä½œç”¨åŸŸï¼š

* è‡ªåŠ¨ `delete`

---

### 3ï¸âƒ£ ä¸ºä»€ä¹ˆä¸èƒ½æ‹·è´ï¼Ÿ

```cpp
std::unique_ptr<int> p1 = std::make_unique<int>(10);
std::unique_ptr<int> p2 = p1; // âŒ ç¼–è¯‘é”™è¯¯
```

åŸå› ï¼š

* é˜²æ­¢ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶ `delete` åŒä¸€å—å†…å­˜

---

### 4ï¸âƒ£ ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰è½¬ç§»æ‰€æœ‰æƒ

```cpp
std::unique_ptr<int> p2 = std::move(p1);
```

ç»“æœï¼š

* `p2` æ‹¥æœ‰èµ„æº
* `p1` å˜ä¸º `nullptr`

---

### 5ï¸âƒ£ ä½¿ç”¨åœºæ™¯ï¼ˆé¢è¯•å¸¸é—®ï¼‰

* å·¥å‚å‡½æ•°è¿”å›èµ„æº
* ç±»çš„æˆå‘˜ç‹¬å èµ„æº
* æ›¿ä»£è£¸ `new/delete`

---

## å››ã€`shared_ptr` â€”â€” å…±äº«æ‰€æœ‰æƒ

### 1ï¸âƒ£ æ ¸å¿ƒæ€æƒ³

> **å¤šä¸ª `shared_ptr` å¯ä»¥å…±åŒæ‹¥æœ‰åŒä¸€èµ„æº**

åŸç†ï¼š

* å¼•ç”¨è®¡æ•°ï¼ˆReference Countï¼‰

---

### 2ï¸âƒ£ åŸºæœ¬ç”¨æ³•

```cpp
std::shared_ptr<int> p1 = std::make_shared<int>(10);
std::shared_ptr<int> p2 = p1;
```

æ­¤æ—¶ï¼š

* å¼•ç”¨è®¡æ•° = 2

---

### 3ï¸âƒ£ ä½•æ—¶é‡Šæ”¾èµ„æºï¼Ÿ

> **å½“æœ€åä¸€ä¸ª `shared_ptr` ææ„æ—¶**

å¼•ç”¨è®¡æ•° â†’ 0 â†’ è‡ªåŠ¨ `delete`

---

### 4ï¸âƒ£ å¸¸è§é™·é˜±ï¼šå¾ªç¯å¼•ç”¨

```cpp
struct A {
    std::shared_ptr<B> b;
};
struct B {
    std::shared_ptr<A> a;
};
```

ç»“æœï¼š

* A å¼•ç”¨ B
* B å¼•ç”¨ A
* å¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º 0 âŒ

---

## äº”ã€`weak_ptr` â€”â€” è§‚å¯Ÿè€…ï¼ˆä¸æ‹¥æœ‰èµ„æºï¼‰

### 1ï¸âƒ£ ä¸ºä»€ä¹ˆéœ€è¦ weak_ptrï¼Ÿ

> **ç”¨æ¥æ‰“ç ´ `shared_ptr` çš„å¾ªç¯å¼•ç”¨**

* ä¸å¢åŠ å¼•ç”¨è®¡æ•°
* ä¸æ§åˆ¶èµ„æºç”Ÿå‘½å‘¨æœŸ

---

### 2ï¸âƒ£ åŸºæœ¬ç”¨æ³•

```cpp
std::weak_ptr<int> wp = sp;
```

---

### 3ï¸âƒ£ å¦‚ä½•å®‰å…¨ä½¿ç”¨ï¼Ÿ

```cpp
if (auto sp = wp.lock()) {
    // èµ„æºä»ç„¶å­˜åœ¨
}
```

* `lock()` æˆåŠŸ â†’ è¿”å› `shared_ptr`
* å¦åˆ™ â†’ èµ„æºå·²é‡Šæ”¾

---

### 4ï¸âƒ£ å…¸å‹ä½¿ç”¨åœºæ™¯

* çˆ¶å­èŠ‚ç‚¹ï¼ˆæ ‘ / å›¾ï¼‰
* ç¼“å­˜
* è§‚å¯Ÿè€…æ¨¡å¼

---

## å…­ã€ä¸‰ç§æ™ºèƒ½æŒ‡é’ˆå¯¹æ¯”ï¼ˆå¿…èƒŒï¼‰

| æŒ‡é’ˆç±»å‹       | æ‰€æœ‰æƒ | å¯æ‹·è´ | å¯ç§»åŠ¨ | å…¸å‹ç”¨é€”    |
| ---------- | --- | --- | --- | ------- |
| unique_ptr | ç‹¬å   | âŒ   | âœ…   | èµ„æºå”¯ä¸€æ‹¥æœ‰è€… |
| shared_ptr | å…±äº«  | âœ…   | âœ…   | å¤šæ–¹ä½¿ç”¨èµ„æº  |
| weak_ptr   | æ—    | âœ…   | âœ…   | è§‚å¯Ÿã€ä¸æ‹¥æœ‰  |

---

## ä¸ƒã€ä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸€ä¸ªï¼Ÿï¼ˆå·¥ç¨‹ç»éªŒï¼‰

* **é»˜è®¤ç”¨ `unique_ptr`**
* ç¡®å®éœ€è¦å…±äº«æ—¶æ‰ç”¨ `shared_ptr`
* å‡ºç°å¾ªç¯å¼•ç”¨ â†’ å¿…é¡»å¼•å…¥ `weak_ptr`

---
